<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XYí´ëœ ê²Œì‹œíŒ</title>
  <!-- Google AdSense ì½”ë“œ -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9686733290484221"
     crossorigin="anonymous"></script>
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap');

    :root {
      --primary-color: #00A2FF;
      --secondary-color: #FF6B6B;
      --background-color: #1a1a1a;
      --text-color: #ffffff;
      --border-color: #ffffff;
      --shadow-color: rgba(0, 0, 0, 0.3);
      --hover-color: #008AE6;
      --roblox-green: #57FF57;
      --roblox-red: #FF3B3B;
      --gradient-blue: linear-gradient(
        45deg,
        #00A2FF,
        #0066FF,
        #00A2FF
      );
      --gradient-rainbow: linear-gradient(
        45deg,
        #ff0000,
        #ff9a00,
        #d0de21,
        #4fdc4a,
        #3fdad8,
        #2fc9e2,
        #1c7fee,
        #5f15f2,
        #ba0cf8,
        #fb07d9
      );
      --gradient-neon: linear-gradient(
        135deg,
        #ff00ff,
        #00ffff,
        #ff00ff
      );
      --gradient-gold: linear-gradient(
        45deg,
        #FFD700,
        #FFA500,
        #FF8C00,
        #FFD700
      );
      --gradient-header: linear-gradient(
        135deg,
        #0052D4,
        #4364F7,
        #00A2FF
      );
    }

    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
      margin: 0;
      padding: 0;
      color: var(--text-color);
      line-height: 1.6;
    }

    header {
      background: var(--gradient-header);
      background-size: 400% 400%;
      animation: headerGradient 15s ease infinite;
      color: rgb(255, 255, 255);
      padding: 2.5rem 1rem;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0, 162, 255, 0.5);
      margin-bottom: 2rem;
      border-bottom: 4px solid rgba(255, 255, 255, 0.3);
    }

    @keyframes headerGradient {
      0% {
        background-position: 0% 50%;
      }
      50% {
        background-position: 100% 50%;
      }
      100% {
        background-position: 0% 50%;
      }
    }

    header h1 {
      margin: 0;
      font-weight: 900;
      font-size: 2.5rem;
      background: linear-gradient(to right, #ffffff, #E0E0E0);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 0 20px rgba(0, 162, 255, 0.8);
      text-transform: uppercase;
      letter-spacing: 2px;
      animation: glowBlue 2s ease-in-out infinite;
    }

    @keyframes glowBlue {
      0%, 100% {
        filter: drop-shadow(0 0 5px rgba(0, 162, 255, 0.8));
      }
      50% {
        filter: drop-shadow(0 0 20px rgba(0, 162, 255, 1));
      }
    }

    button {
      padding: 1rem 1.8rem;
      margin: 0.7rem 0;
      border: 4px solid transparent;
      border-radius: 8px;
      background: rgb(92, 92, 92);
      color: rgb(255, 255, 255);
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      position: relative;
      background-clip: padding-box;
    }

    button::before {
      content: '';
      position: absolute;
      top: -4px;
      right: -4px;
      bottom: -4px;
      left: -4px;
      z-index: -1;
      border-radius: 12px;
      background: var(--gradient-blue);
      background-size: 200% 200%;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    button:hover::before {
      opacity: 1;
      animation: blueShift 3s ease infinite;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 162, 255, 0.3);
    }

    button:active {
      transform: translateY(2px);
    }

    .youtube-button {
      background: #ff0000;
      color: rgb(255, 255, 255);
    }

    .discord-button {
      background: #7289DA;
      color: rgb(255, 255, 255);
    }

    .like-button {
      background: #ff4757;
      color: rgb(255, 255, 255);
    }

    .edit-button {
      background: #2ed573;
      color: rgb(255, 255, 255);
    }

    .delete-button {
      background: #ff6b6b;
      color: rgb(255, 255, 255);
    }

    .admin-button {
      background: #ffa502;
      color: rgb(255, 255, 255);
    }

    .search-button {
      background: #1e90ff;
      color: rgb(255, 255, 255);
    }

    @keyframes blueShift {
      0% {
        background-position: 0% 50%;
      }
      50% {
        background-position: 100% 50%;
      }
      100% {
        background-position: 0% 50%;
      }
    }

    main {
      max-width: 1200px; /* ë„“ì€ í™”ë©´ì—ì„œ ë” ë§ì€ ê³µê°„ ì‚¬ìš© */
      margin: 2rem auto;
      background: rgba(255, 255, 255, 0.1);
      padding: 2.5rem;
      box-shadow: 
        0 8px 32px rgba(31, 38, 135, 0.37);
      border-radius: 12px;
      border: 1px solid rgb(255, 255, 255);
      backdrop-filter: blur(4px);
    }

    input, textarea, .species-select {
      width: 100%;
      padding: 1rem;
      margin: 0.7rem 0;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.05);
      color: rgb(255, 255, 255);
      font-weight: 500;
      box-shadow: 
        0 2px 0 rgba(0, 0, 0, 0.1),
        0 0 10px rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(4px);
    }

    input:focus, textarea:focus, .species-select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 
        0 0 0 4px rgba(0, 162, 255, 0.2),
        0 0 20px rgba(0, 162, 255, 0.3);
      background: rgba(255, 255, 255, 0.1);
    }

    #postList div {
      border: 1px solid rgba(255, 255, 255, 0.18);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem; /* ê²Œì‹œê¸€ ê°„ ê°„ê²© ì¡°ì • */
      cursor: pointer;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.05);
      box-shadow: 
        0 4px 0 rgba(0, 0, 0, 0.1),
        0 0 20px rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(4px);
    }

    #postList div:hover {
      transform: translateY(-4px);
      border-color: var(--primary-color);
      box-shadow: 
        0 8px 0 rgba(0, 0, 0, 0.1),
        0 0 30px rgba(255, 255, 255, 0.2);
      background: rgba(255, 255, 255, 0.1);
    }

    #postList div strong {
      font-size: 1.2rem;
      color: var(--text-color);
      display: block;
      margin-bottom: 0.8rem;
    }

    #postList div small {
      color: #666;
    }

    #postDetail {
      display: none;
      margin-top: 2.5rem; /* ë””í…Œì¼ ë·° ìƒë‹¨ ê°„ê²© ì¡°ì • */
      border-top: 2px solid var(--border-color);
      padding-top: 1.5rem;
      animation: fadeIn 0.3s ease;
    }

    #detailTitle {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 1rem;
      color: var(--text-color);
    }

    #detailAuthor {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 0.5rem 1rem;
      background-color: var(--background-color);
      border-radius: 20px;
      font-size: 0.8rem;
      color: #666;
      margin-bottom: 1.5rem;
    }

    #detailContent {
      line-height: 1.8;
      margin: 2rem 0;
      padding: 1.5rem;
      background-color: var(--background-color);
      border-radius: 12px;
      border: 2px solid var(--border-color);
    }

    .comment-section {
      margin-top: 3.5rem; /* ëŒ“ê¸€ ì„¹ì…˜ ìƒë‹¨ ê°„ê²© ì¡°ì • */
      padding-top: 2rem;
      border-top: 2px solid var(--border-color);
    }

    .comment-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 1.5rem;
      font-size: 1.2rem;
      font-weight: 600;
    }

    .comment {
      background-color: var(--background-color);
      margin: 1rem 0;
      padding: 1.2rem;
      border-radius: 12px;
      border: 2px solid var(--border-color);
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .comment-author {
      font-weight: 600;
      color: var(--primary-color);
    }

    .comment-text {
      line-height: 1.6;
    }

    .comment-meta {
      font-size: 0.8rem;
      color: #666;
    }

    #newComment {
      margin-top: 1.5rem;
      resize: vertical;
      min-height: 80px;
    }

    #postForm {
      background-color: rgb(92, 92, 92);
      padding: 2rem;
      border-radius: 16px;
      border: 3px solid var(--border-color); /* í…Œë‘ë¦¬ ë‘ê»˜ ì¡°ì • */
      margin-bottom: 3rem; /* ê²Œì‹œê¸€ í¼ í•˜ë‹¨ ê°„ê²© ì¡°ì • */
      box-shadow: 0 4px 15px var(--shadow-color);
    }

    #postForm h2 {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 1.5rem;
    }

    #postForm h2::before {
      content: "âœï¸";
    }

    .post-type-select {
      width: 100%;
      padding: 1rem;
      margin: 0.7rem 0;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      font-size: 1rem;
      background: rgba(255, 255, 255, 0.05);
      color: rgb(255, 255, 255);
      backdrop-filter: blur(4px);
    }

    .post-type-select option {
      background: rgb(92, 92, 92);
      color: white;
    }

    .post-badge {
      display: inline-block;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: 700;
      margin-right: 0.5rem;
    }

    .post-badge.notice {
      background: #ff4757;
      color: white;
    }

    .post-badge.general {
      background: #1e90ff;
      color: white;
    }

    .post-badge.info {
      background: #2ed573;
      color: white;
    }

    .post-meta {
      display: flex;
      align-items: center;
      gap: 12px;
      color: #666;
      font-size: 0.9rem;
      margin-top: 1rem;
      padding: 0.5rem 0;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .post-meta span {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .post-actions {
      display: flex;
      gap: 8px;
      margin-top: 1rem;
    }

    .share-button {
      background: #1e90ff;
      color: white;
    }

    .report-button {
      background: #ff4757;
      color: white;
    }

    .views-count {
      color: rgb(200, 200, 200);
    }

    #reportModal .modal-content {
      background: rgb(92, 92, 92);
      padding: 2rem;
      border-radius: 12px;
    }

    #reportModal textarea {
      width: 100%;
      min-height: 100px;
      margin: 1rem 0;
    }

    #userArea {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      padding: 2rem; /* ì‚¬ìš©ì ì˜ì—­ íŒ¨ë”© ì¡°ì • */
      border-radius: 16px;
      margin-bottom: 3rem; /* ì‚¬ìš©ì ì˜ì—­ í•˜ë‹¨ ê°„ê²© ì¡°ì • */
      color: rgb(95, 95, 95);
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 15px var(--shadow-color);
    }

    #userInfo {
      margin: 0;
      font-weight: 600;
      font-size: 1.2rem;
      color: white;
    }

    #userArea button {
      background-color: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.4);
    }

    #userArea button:hover {
      background-color: rgba(255, 255, 255, 0.3);
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      backdrop-filter: blur(5px);
    }

    .modal {
      background-color: rgb(99, 99, 99);
      padding: 2.5rem;
      border-radius: 12px;
      box-shadow: 
        0 8px 0 rgba(0, 0, 0, 0.1),
        0 0 0 4px rgba(0, 0, 0, 0.05) inset;
      width: 90%;
      max-width: 500px;
      transform: scale(0.9);
      opacity: 0;
      animation: modalAppear 0.3s ease forwards;
      border: 4px solid var(--primary-color);
    }

    @keyframes modalAppear {
      to {
        transform: scale(1);
        opacity: 1;
      }
    }

    .modal h2 {
      margin-top: 0;
      color: var(--text-color);
      font-size: 1.8rem;
    }

    .modal-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
      margin-top: 2rem;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 1rem 1.5rem;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 
        0 4px 0 rgba(0, 0, 0, 0.1),
        0 0 20px rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      gap: 12px;
      z-index: 1000;
      animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s;
      max-width: 400px;
      border-radius: 8px;
    }

    .notification-icon {
      font-size: 1.5rem;
    }

    .notification-content {
      flex: 1;
    }

    .notification-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .notification-message {
      font-size: 0.9rem;
      color: #666;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes fadeOut {
      from {
        opacity: 1;
      }
      to {
        opacity: 0;
      }
    }

    .admin-badge {
      background: var(--gradient-gold);
      background-size: 200% 200%;
      color: rgb(87, 87, 87);
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 900;
      margin-left: 8px;
      text-transform: uppercase;
      box-shadow: 
        0 2px 0 rgba(0, 0, 0, 0.3),
        0 0 10px rgba(255, 215, 0, 0.5);
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      animation: goldShift 3s ease infinite;
    }

    @keyframes goldShift {
      0% {
        background-position: 0% 50%;
      }
      50% {
        background-position: 100% 50%;
      }
      100% {
        background-position: 0% 50%;
      }
    }

    .admin-panel {
      background: rgb(114, 114, 114);
      padding: 2rem;
      border-radius: 16px;
      margin-bottom: 2rem;
      border: 2px solid var(--border-color);
      box-shadow: 0 4px 15px var(--shadow-color);
    }

    .admin-panel h2 {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 1.5rem;
      color: #ff6b6b;
    }

    .admin-panel h2::before {
      content: "ğŸ‘‘";
    }

    .user-list {
      display: grid;
      gap: 1rem;
      margin-top: 1rem;
    }

    .user-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem;
      background: var(--background-color);
      border-radius: 12px;
      border: 2px solid var(--border-color);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .user-actions {
      display: flex;
      gap: 8px;
    }

    .admin-button {
      background-color: #ff6b6b;
    }

    .admin-button:hover {
      background-color: #ff5252;
    }

    /* ëª¨ë˜í•œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .modern-button {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      border: none;
      padding: 1rem 2rem;
      border-radius: 12px;
      color: rgb(90, 90, 90);
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    /* ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
    .fade-slide-in {
      animation: fadeSlideIn 0.5s ease forwards;
    }

    @keyframes fadeSlideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .admin-dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* ì¹´ë“œ ìµœì†Œ ë„ˆë¹„ ì¡°ì • */
      gap: 1.5rem;
      padding: 2rem;
    }

    .dashboard-card {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(4px);
      border: 1px solid rgba(255, 255, 255, 0.18);
      box-shadow: 
        0 6px 0 rgba(0, 0, 0, 0.1),
        0 0 20px rgba(255, 255, 255, 0.1);
      transition: transform 0.3s ease;
      border-radius: 12px;
    }

    .dashboard-card:hover {
      transform: translateY(-5px);
      border-color: var(--primary-color);
    }

    .stat-number {
      font-size: 2.5rem;
      font-weight: 900;
      color: var(--primary-color);
      margin: 1rem 0;
      text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.1);
      background: var(--gradient-neon);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      animation: glow 2s ease-in-out infinite;
    }

    @keyframes glow {
      0%, 100% {
        filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5));
      }
      50% {
        filter: drop-shadow(0 0 20px rgba(92, 92, 92, 0.8));
      }
    }

    .stat-chart {
      height: 200px;
      background-color: #5f5f5f;
      border-radius: 10px;
      overflow: hidden;
    }

    .report-list {
      max-height: 250px; /* ì‹ ê³  ëª©ë¡ ìµœëŒ€ ë†’ì´ ì¡°ì • */
      overflow-y: auto;
    }

    .report-badge {
      background: #ff4757;
      color: white;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: 700;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% {
        opacity: 1;
      }
      50% {
        opacity: 0.5;
      }
      100% {
        opacity: 1;
      }
    }

    #reportModal .modal {
      max-width: 500px;
      width: 90%;
    }

    #reportModal textarea {
      width: 100%;
      min-height: 100px;
      margin: 1rem 0;
      padding: 1rem;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.05);
      color: white;
      resize: vertical;
    }

    #reportModal .modal-buttons {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
      margin-top: 1rem;
    }

    .post-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .report-button {
      background: #ff4757;
      color: white;
    }

    .report-button:hover {
      background: #ff6b6b;
    }

    /* ìƒˆë¡œìš´ ìŠ¤íƒ€ì¼ ì¶”ê°€: ê²Œì‹œê¸€ ëª©ë¡ê³¼ ìƒì„¸ ì •ë³´ë¥¼ ë‹´ì„ ì»¨í…Œì´ë„ˆ */
    .post-container {
      display: flex;
      gap: 2rem; /* ëª©ë¡ê³¼ ìƒì„¸ ì •ë³´ ì‚¬ì´ ê°„ê²© */
      flex-wrap: wrap; /* í™”ë©´ì´ ì¢ì•„ì§€ë©´ ì¤„ë°”ê¿ˆ */
    }

    #postList {
      flex: 1; /* ë‚¨ì€ ê³µê°„ì„ ì±„ìš°ë„ë¡ ì„¤ì • */
      min-width: 300px; /* ìµœì†Œ ë„ˆë¹„ ì„¤ì • */
    }

    #postDetail {
      flex: 2; /* ëª©ë¡ë³´ë‹¤ ë” ë§ì€ ê³µê°„ ì‚¬ìš© */
      min-width: 400px; /* ìµœì†Œ ë„ˆë¹„ ì„¤ì • */
      display: none; /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
      margin-top: 0; /* Flexbox ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œëŠ” margin-top ë¶ˆí•„ìš” */
      border-top: none; /* Flexbox ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œëŠ” border-top ë¶ˆí•„ìš” */
      padding-top: 0; /* Flexbox ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œëŠ” padding-top ë¶ˆí•„ìš” */
      border-left: 2px solid var(--border-color); /* ì™¼ìª½ì— êµ¬ë¶„ì„  ì¶”ê°€ */
      padding-left: 2rem; /* êµ¬ë¶„ì„ ê³¼ ë‚´ìš© ì‚¬ì´ ê°„ê²© */
      animation: fadeIn 0.3s ease;
    }

    /* ì‘ì€ í™”ë©´ì—ì„œëŠ” ì„¸ë¡œë¡œ ë°°ì¹˜ */
    @media (max-width: 768px) {
      .post-container {
        flex-direction: column; /* ì„¸ë¡œë¡œ ì¬ë°°ì¹˜ */
      }

      #postList,
      #postDetail {
        flex: none; /* Flex ì†ì„± í•´ì œ */
        width: 100%; /* ë„ˆë¹„ ì „ì²´ ì‚¬ìš© */
        min-width: unset; /* ìµœì†Œ ë„ˆë¹„ í•´ì œ */
      }

      #postDetail {
        margin-top: 2rem; /* ë‹¤ì‹œ ìƒë‹¨ ë§ˆì§„ ì¶”ê°€ */
        border-top: 2px solid var(--border-color); /* ë‹¤ì‹œ ìƒë‹¨ êµ¬ë¶„ì„  ì¶”ê°€ */
        padding-top: 1.5rem; /* ë‹¤ì‹œ ìƒë‹¨ íŒ¨ë”© ì¶”ê°€ */
        border-left: none; /* ì™¼ìª½ êµ¬ë¶„ì„  ì œê±° */
        padding-left: 0; /* ì™¼ìª½ íŒ¨ë”© ì œê±° */
      }
    }

    .google-login-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      background-color: white;
      color: #757575;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px 20px;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.3s;
      width: 100%;
      margin-top: 10px;
    }

    .google-login-btn:hover {
      background-color: #f5f5f5;
    }

    .google-login-btn img {
      width: 18px;
      height: 18px;
    }
  </style>
</head>
<body>
  <header>
    <h1>XYí´ëœ ì»¤ë®¤ë‹ˆí‹°</h1>
  </header>

  <main>
    <div id="authForm">
        <input type="text" id="username" placeholder="ì´ë¦„ (ë‹‰ë„¤ì„) ì…ë ¥"><br>
        <input type="email" id="email" placeholder="ì´ë©”ì¼ ì…ë ¥"><br>
        <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"><br>
        <select id="species" class="species-select">
          <option value="">ì¢…ì¡±ì„ ì„ íƒí•˜ì„¸ìš”</option>
          <option value="polar-bear">ğŸ»â€â„ï¸ ë¶ê·¹ê³°</option>
          <option value="cat">ğŸ± ê³ ì–‘ì´</option>
          <option value="dinosaur">ğŸ¦– ê³µë£¡</option>
          <option value="pig">ğŸ· ë¼ì§€</option>
          <option value="dog">ğŸ¶ ê°•ì•„ì§€</option>
          <option value="bird">ğŸ¦ ìƒˆ</option>
          <option value="fish">ğŸŸ ë¬¼ê³ ê¸°</option>
          <option value="snake">ğŸ ë„ë§ˆë±€</option>
          <option value="tiger">ğŸ¯ í˜¸ë‘ì´</option>
          <option value="elephant">ğŸ˜ ì½”ë¼ë¦¬</option>
          <option value="monkey">ğŸ’ ì›ìˆ­ì´</option>
          <option value="wolf">ğŸº ëŠ‘ëŒ€</option>
          <option value="deer">ğŸ¦Œ ì‚¬ìŠ´</option>
          <option value="none">âŒ ì—†ìŒ</option>

          
        </select><br>
        <button onclick="register()">íšŒì›ê°€ì…</button>
        <button onclick="login()">ë¡œê·¸ì¸</button>
        <button onclick="googleLogin()" class="google-login-btn">
          <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
          Googleë¡œ ë¡œê·¸ì¸
        </button>
      </div>

    <!-- ìƒë‹¨ ê´‘ê³  -->
    <div class="ad-container" style="margin: 20px 0; text-align: center;">
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-9686733290484221"
           data-ad-slot="XXXXXXXXXX"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>
           (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>

    <div id="userArea" style="display:none;">
      <p id="userInfo"></p>
      <button onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>

    <!-- ê²Œì‹œê¸€ ëª©ë¡ê³¼ ìƒì„¸ë³´ê¸° ì‚¬ì´ ê´‘ê³  -->
    <div class="ad-container" style="margin: 20px 0; text-align: center;">
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-9686733290484221"
           data-ad-slot="XXXXXXXXXX"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>
           (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>

    <div id="postForm" style="display:none;">
      <h2>ê²Œì‹œê¸€ ì‘ì„±</h2>
      <select id="postType" class="post-type-select">
        <option value="general">ì¼ë°˜ ê²Œì‹œê¸€</option>
        <option value="info">ì •ë³´ ê²Œì‹œê¸€</option>
        <option value="notice">ê³µì§€ì‚¬í•­</option>
      </select>
      <input type="text" id="title" placeholder="ì œëª©"><br>
      <textarea id="content" rows="4" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea><br>
      <button onclick="submitPost()">ì‘ì„± ì™„ë£Œ</button>
    </div>

    <div id="postList">
      <h2>ğŸ“„ ê²Œì‹œê¸€ ëª©ë¡</h2>
      <div class="search-bar">
        <input type="text" id="searchInput" placeholder="ê²Œì‹œê¸€ ê²€ìƒ‰...">
        <button onclick="searchPosts()">ê²€ìƒ‰</button>
      </div>
      <div class="sort-buttons">
        <button onclick="sortPosts('latest')">ìµœì‹ ìˆœ</button>
        <button onclick="sortPosts('likes')">ì¸ê¸°ìˆœ</button>
      </div>
    </div>

    <div id="postDetail">
      <h3 id="detailTitle"></h3>
      <div id="detailAuthor"></div>
      <div id="detailContent"></div>
      <div class="post-meta">
        <span class="like-count">â¤ï¸ <span id="likeCount">0</span></span>
        <span id="detailDate"></span>
      </div>
      <div class="post-actions" style="margin-bottom: 1.5rem;">
        <button class="like-button" onclick="toggleLike()">
          ì¢‹ì•„ìš”
        </button>
        <button class="edit-button" onclick="editPost()" style="display: none;">ìˆ˜ì •</button>
        <button class="delete-button" onclick="deletePost()" style="display: none;">ì‚­ì œ</button>
      </div>
      
      <div class="comment-section">
        <div class="comment-header">
          <span>ğŸ’¬</span>
          <span>ëŒ“ê¸€</span>
        </div>
        <div id="commentList"></div>
        <textarea id="newComment" placeholder="ëŒ“ê¸€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”..." rows="3"></textarea>
        <button onclick="submitComment()">ëŒ“ê¸€ ì‘ì„±</button>
      </div>
    </div>


    <div class="social-buttons">
      <button class="youtube-button" onclick="window.open('https://www.youtube.com/@í‹°ë¯¸ì›”ë“œ', '_blank')">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
        </svg>
        ìœ íŠœë¸Œ ì±„ë„
      </button>
      <button class="discord-button" onclick="requestDiscordJoin()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.118.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.419c0 1.334-.956 2.419-2.157 2.419zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.419c0 1.334-.946 2.419-2.157 2.419z"/>
        </svg>
        ë””ìŠ¤ì½”ë“œ ì°¸ì—¬ ìš”ì²­
      </button>
    </div>

    <!-- ë””ìŠ¤ì½”ë“œ ì°¸ì—¬ ìš”ì²­ ëª¨ë‹¬ -->
    <div id="discordRequestModal" class="modal-overlay" style="display: none;">
      <div class="modal">
        <h2>ë””ìŠ¤ì½”ë“œ ì°¸ì—¬ ìš”ì²­</h2>
        <p>ì•„ë˜ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
        <textarea id="requestReason" placeholder="ì°¸ì—¬í•˜ê³  ì‹¶ì€ ì´ìœ ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”." rows="4"></textarea>
        <input type="text" id="robloxNickname" placeholder="ë¡œë¸”ë¡ìŠ¤ ë‹‰ë„¤ì„">
        <label for="isInClan">ì´ë¯¸ ë‹¤ë¥¸ í´ëœì— ì†Œì†ë˜ì–´ ìˆë‚˜ìš”?</label>
        <select id="isInClan">
          <option value="no">ì•„ë‹ˆì˜¤</option>
          <option value="yes">ì˜ˆ</option>
        </select>
        <div class="modal-buttons">
          <button onclick="submitDiscordRequest()">ìš”ì²­ ì œì¶œ</button>
          <button onclick="closeDiscordRequestModal()" class="modern-button">ì·¨ì†Œ</button>
        </div>
      </div>
    </div>

    <div id="adminPanel" style="display: none;" class="admin-panel">
      <h2>ê´€ë¦¬ì íŒ¨ë„</h2>
      <div class="admin-controls">
        <button onclick="showUserList()" class="admin-button">ì‚¬ìš©ì ê´€ë¦¬</button>
        <button onclick="showAllPosts()" class="admin-button">ì „ì²´ ê²Œì‹œê¸€ ê´€ë¦¬</button>
        <button onclick="showDiscordRequests()" class="admin-button">ë””ìŠ¤ì½”ë“œ ì°¸ì—¬ ìš”ì²­</button>
      </div>
      <div id="userList" class="user-list"></div>
      <div id="discordRequests" class="user-list" style="display: none;"></div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyCVciBor_0vj8NyuKJ080-HyfE-VRjam70",
        authDomain: "yxclan-90b06.firebaseapp.com",
        projectId: "yxclan-90b06",
        storageBucket: "yxclan-90b06.appspot.com",
        messagingSenderId: "291460759619",
        appId: "1:291460759619:web:18bcecb89c3570e7d7d4f6",
        measurementId: "G-QZ9JQRZ3CH"
      };
      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const db = firebase.firestore();

      let currentPostId = null;
      let currentPost = null;

      // ê´€ë¦¬ì UID ëª©ë¡
      const ADMIN_UIDS = [
        'dd',
        'dd',
        'dd',
        'YbfIABREwDetVkK1umXq7bEozrS2',
        'TY0BHaGoImdKC7LwDEEunKHeYCI3'
      ];

      // ì‚¬ìš©ìê°€ ê´€ë¦¬ìì¸ì§€ í™•ì¸í•˜ëŠ” í•¨ìˆ˜
      function isAdmin(uid) {
        return ADMIN_UIDS.includes(uid);
      }

      // Firebase ì„¤ì • í›„ ë°”ë¡œ ì•„ë˜ì— ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      let unsubscribePostsListener = null;

      // ì‹¤ì‹œê°„ ê²Œì‹œê¸€ ì—…ë°ì´íŠ¸ ë¦¬ìŠ¤ë„ˆ
      function setupRealtimeListeners() {
        if (unsubscribePostsListener) {
          unsubscribePostsListener();
        }

        const postList = document.getElementById("postList");
        postList.innerHTML = "<h2>ğŸ“„ ê²Œì‹œê¸€ ëª©ë¡</h2>" +
          '<div class="search-bar">' +
          '<input type="text" id="searchInput" placeholder="ê²Œì‹œê¸€ ê²€ìƒ‰...">' +
          '<button onclick="searchPosts()">ê²€ìƒ‰</button>' +
          '</div>' +
          '<div class="sort-buttons">' +
          '<button onclick="sortPosts(\'latest\')">ìµœì‹ ìˆœ</button>' +
          '<button onclick="sortPosts(\'likes\')">ì¸ê¸°ìˆœ</button>' +
          '</div>';

        unsubscribePostsListener = db.collection("posts")
          .orderBy("createdAt", "desc")
          .onSnapshot((snapshot) => {
            snapshot.docChanges().forEach((change) => {
              if (change.type === "added") {
                const div = createPostElement(change.doc.id, change.doc.data());
                postList.appendChild(div);
              }
              if (change.type === "modified") {
                const existingPost = document.querySelector(`[data-post-id="${change.doc.id}"]`);
                if (existingPost) {
                  const newPost = createPostElement(change.doc.id, change.doc.data());
                  existingPost.replaceWith(newPost);
                }
              }
              if (change.type === "removed") {
                const existingPost = document.querySelector(`[data-post-id="${change.doc.id}"]`);
                if (existingPost) {
                  existingPost.remove();
                }
              }
            });
          });
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
      auth.onAuthStateChanged(user => {
        if (user) {
          db.collection("users").doc(user.uid).get().then(doc => {
            const name = doc.exists ? doc.data().name : user.email;
            const species = doc.exists ? doc.data().species : null;
            const photoURL = doc.exists ? doc.data().photoURL : null; // í”„ë¡œí•„ ì‚¬ì§„ URL
            
            if (!species) {
              document.getElementById("speciesModal").style.display = "flex";
            } else {
              const speciesEmoji = getSpeciesEmoji(species);
              let userInfo = `${speciesEmoji} ${name}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`;
              if (photoURL) {
                userInfo = `<img src="${photoURL}" alt="í”„ë¡œí•„" style="width:40px;height:40px;border-radius:50%;vertical-align:middle;margin-right:8px;">` + userInfo;
              }
              if (isAdmin(user.uid)) {
                userInfo += '<span class="admin-badge">ê´€ë¦¬ì</span>';
                document.getElementById("adminPanel").style.display = "block";
              }
              document.getElementById("userInfo").innerHTML = userInfo;
            }
            
            document.getElementById("authForm").style.display = "none";
            document.getElementById("userArea").style.display = "block";
            document.getElementById("postForm").style.display = "block";
            updatePostTypeOptions();
          });
        } else {
          document.getElementById("authForm").style.display = "block";
          document.getElementById("userArea").style.display = "none";
          document.getElementById("postForm").style.display = "none";
          document.getElementById("speciesModal").style.display = "none";
          document.getElementById("adminPanel").style.display = "none";
        }
        setupRealtimeListeners();
      });

      function register() {
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value.trim();
        const name = document.getElementById("username").value.trim();
        const species = document.getElementById("species").value;
        if (!email || !password || !name || !species) {
          return alert("ì´ë¦„, ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸, ì¢…ì¡±ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”");
        }
        auth.createUserWithEmailAndPassword(email, password)
          .then((userCredential) => {
            return db.collection("users").doc(userCredential.user.uid).set({
              name: name,
              email: email,
              species: species
            });
          })
          .then(() => alert("íšŒì›ê°€ì… ì™„ë£Œ"))
          .catch(error => alert("ì˜¤ë¥˜: " + error.message));
      }

      function login() {
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value.trim();
        if (!email || !password) return alert("ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í•„ìˆ˜");
        auth.signInWithEmailAndPassword(email, password)
          .catch(error => alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + error.message));
      }

      function logout() {
        auth.signOut();
      }

      // ê²Œì‹œê¸€ ì‘ì„± í•¨ìˆ˜
      async function submitPost() {
        const user = auth.currentUser;
        if (!user) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");

        // ì°¨ë‹¨ëœ ì‚¬ìš©ì í™•ì¸
        const userDoc = await db.collection("users").doc(user.uid).get();
        if (userDoc.exists && userDoc.data().isBanned) {
          return alert("ì°¨ë‹¨ëœ ì‚¬ìš©ìëŠ” ê²Œì‹œê¸€ì„ ì‘ì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }

        const title = document.getElementById("title").value.trim();
        const content = document.getElementById("content").value.trim();
        const postType = document.getElementById("postType").value;

        if (!title || !content) return alert("ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.");
        
        // ê³µì§€ì‚¬í•­ ê¶Œí•œ ì²´í¬
        if (postType === 'notice' && !isAdmin(user.uid)) {
          return alert("ê³µì§€ì‚¬í•­ì€ ê´€ë¦¬ìë§Œ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
        }

        db.collection("users").doc(user.uid).get().then(doc => {
          const authorName = doc.exists ? doc.data().name : user.email;
          db.collection("posts").add({
            title,
            content,
            author: authorName,
            authorId: user.uid,
            createdAt: new Date(),
            postType: postType,
            views: 0,
            likeCount: 0,
            likes: {},
            reports: [],
            isReported: false
          }).then(() => {
            document.getElementById("title").value = "";
            document.getElementById("content").value = "";
            document.getElementById("postType").value = "general";
            loadPosts();
          });
        });
      }

      function loadPosts() {
        const user = auth.currentUser;
        let query = db.collection("posts");

        if (!isAdmin(user?.uid)) {
          // ê´€ë¦¬ìê°€ ì•„ë‹Œ ê²½ìš° ê³µì§€ì‚¬í•­ ì œì™¸
          query = query.where("postType", "!=", "notice");
        }

        query.orderBy("createdAt", "desc")
          .get()
          .then((snapshot) => {
            const postList = document.getElementById("postList");
            postList.innerHTML = "<h2>ğŸ“„ ê²Œì‹œê¸€ ëª©ë¡</h2>";
            snapshot.forEach((doc) => {
              const div = createPostElement(doc.id, doc.data());
              postList.appendChild(div);
            });
          });
      }

      function showPostDetail(id) {
        const postRef = db.collection("posts").doc(id);
        postRef.get().then(doc => {
          if (doc.exists) {
            const data = doc.data();
            document.getElementById("detailTitle").innerText = data.title;
            document.getElementById("detailAuthor").innerText = `ì‘ì„±ì: ${data.author}`;
            document.getElementById("detailContent").innerText = data.content;
            document.getElementById("detailDate").innerText = 
              `ì‘ì„±ì¼: ${data.createdAt ? data.createdAt.toDate().toLocaleString() : 'ë‚ ì§œ ì—†ìŒ'}`;
            document.getElementById("likeCount").innerText = data.likeCount || 0;
            document.getElementById("postDetail").style.display = "block";
            
            // ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ í‘œì‹œ ì—¬ë¶€
            const user = auth.currentUser;
            const editButton = document.querySelector(".edit-button");
            const deleteButton = document.querySelector(".delete-button");
            if (user && (data.authorId === user.uid || isAdmin(user.uid))) {
              editButton.style.display = "block";
              deleteButton.style.display = "block";
            } else {
              editButton.style.display = "none";
              deleteButton.style.display = "none";
            }
            
            currentPostId = id;
            currentPost = data;
            loadComments(id);
          }
        });
      }

      function loadComments(postId) {
        const commentList = document.getElementById("commentList");
        commentList.innerHTML = "";
        db.collection("posts").doc(postId).collection("comments")
          .orderBy("createdAt", "desc")
          .get().then(snapshot => {
            snapshot.forEach(doc => {
              const data = doc.data();
              const div = document.createElement("div");
              div.className = "comment";
              const date = data.createdAt ? data.createdAt.toDate().toLocaleString() : 'ë‚ ì§œ ì—†ìŒ';
              div.innerHTML = `
                <div class="comment-author">${data.author}</div>
                <div class="comment-text">${data.text}</div>
                <div class="comment-meta">${date}</div>
              `;
              commentList.appendChild(div);
            });
          });
      }

      // ëŒ“ê¸€ ì‘ì„± í•¨ìˆ˜
      async function submitComment() {
        const user = auth.currentUser;
        if (!user) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");

        // ì°¨ë‹¨ëœ ì‚¬ìš©ì í™•ì¸
        const userDoc = await db.collection("users").doc(user.uid).get();
        if (userDoc.exists && userDoc.data().isBanned) {
          return alert("ì°¨ë‹¨ëœ ì‚¬ìš©ìëŠ” ëŒ“ê¸€ì„ ì‘ì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }

        const text = document.getElementById("newComment").value.trim();
        if (!text) return alert("ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”.");
        
        db.collection("users").doc(user.uid).get().then(doc => {
          const authorName = doc.exists ? doc.data().name : user.email;
          db.collection("posts").doc(currentPostId).collection("comments").add({
            text,
            author: authorName,
            authorId: user.uid,
            createdAt: new Date()
          }).then(() => {
            document.getElementById("newComment").value = "";
            loadComments(currentPostId);

            // ê²Œì‹œê¸€ ì‘ì„±ìì—ê²Œ ëŒ“ê¸€ ì•Œë¦¼
            db.collection("posts").doc(currentPostId).get().then(postDoc => {
              const postData = postDoc.data();
              if (postData.authorId !== user.uid) {
                showBrowserNotification(
                  "ìƒˆë¡œìš´ ëŒ“ê¸€",
                  `${authorName}ë‹˜ì´ íšŒì›ë‹˜ì˜ ê²Œì‹œê¸€ì— ëŒ“ê¸€ì„ ë‚¨ê²¼ìŠµë‹ˆë‹¤.`
                );
                showNotification(
                  "ìƒˆë¡œìš´ ëŒ“ê¸€",
                  `${authorName}ë‹˜ì´ íšŒì›ë‹˜ì˜ ê²Œì‹œê¸€ì— ëŒ“ê¸€ì„ ë‚¨ê²¼ìŠµë‹ˆë‹¤.`,
                  "ğŸ’¬"
                );
              }
            });
          });
        });
      }

      function searchPosts() {
        const searchTerm = document.getElementById("searchInput").value.toLowerCase();
        const postList = document.getElementById("postList");
        postList.innerHTML = "<h2>ğŸ“„ ê²Œì‹œê¸€ ëª©ë¡</h2>" +
          '<div class="search-bar">' +
          '<input type="text" id="searchInput" placeholder="ê²Œì‹œê¸€ ê²€ìƒ‰...">' +
          '<button onclick="searchPosts()">ê²€ìƒ‰</button>' +
          '</div>' +
          '<div class="sort-buttons">' +
          '<button onclick="sortPosts(\'latest\')">ìµœì‹ ìˆœ</button>' +
          '<button onclick="sortPosts(\'likes\')">ì¸ê¸°ìˆœ</button>' +
          '</div>';
      
        db.collection("posts").get().then(snapshot => {
          snapshot.forEach(doc => {
            const data = doc.data();
            if (data.title.toLowerCase().includes(searchTerm) || 
                data.content.toLowerCase().includes(searchTerm)) {
              const div = createPostElement(doc.id, data);
              postList.appendChild(div);
            }
          });
        });
      }
      
      function sortPosts(criteria) {
        const postList = document.getElementById("postList");
        postList.innerHTML = "<h2>ğŸ“„ ê²Œì‹œê¸€ ëª©ë¡</h2>" +
          '<div class="search-bar">' +
          '<input type="text" id="searchInput" placeholder="ê²Œì‹œê¸€ ê²€ìƒ‰...">' +
          '<button onclick="searchPosts()">ê²€ìƒ‰</button>' +
          '</div>' +
          '<div class="sort-buttons">' +
          '<button onclick="sortPosts(\'latest\')">ìµœì‹ ìˆœ</button>' +
          '<button onclick="sortPosts(\'likes\')">ì¸ê¸°ìˆœ</button>' +
          '</div>';
      
        let query = db.collection("posts");
        if (criteria === 'latest') {
          query = query.orderBy("createdAt", "desc");
        } else if (criteria === 'likes') {
          query = query.orderBy("likeCount", "desc");
        }
      
        query.get().then(snapshot => {
          snapshot.forEach(doc => {
            const div = createPostElement(doc.id, doc.data());
            postList.appendChild(div);
          });
        });
      }
      
      function createPostElement(id, data) {
        const div = document.createElement("div");
        div.setAttribute('data-post-id', id);
        const date = data.createdAt ? data.createdAt.toDate().toLocaleString() : 'ë‚ ì§œ ì—†ìŒ';
        const likes = data.likeCount || 0;
        const views = data.views || 0;
        const reports = data.reports ? data.reports.length : 0;
        
        const postTypeBadge = `<span class="post-badge ${data.postType}">${
          data.postType === 'notice' ? 'ê³µì§€' :
          data.postType === 'info' ? 'ì •ë³´' : 'ì¼ë°˜'
        }</span>`;

        div.innerHTML = `
          <div class="post-header" onclick="showPostDetail('${id}')">
            ${postTypeBadge}
            <strong>${data.title}</strong>
          </div>
          <div class="post-meta">
            <span class="views-count">ğŸ‘ï¸ ${views}</span>
            <span>â¤ï¸ ${likes}</span>
            <span>ğŸ“… ${date}</span>
            ${data.isReported ? '<span class="report-badge">ì‹ ê³ ë¨</span>' : ''}
          </div>
          <div class="post-actions">
            <button class="report-button" onclick="event.stopPropagation(); showReportModal('${id}')">ì‹ ê³ </button>
          </div>
        `;

        // ê²Œì‹œê¸€ í´ë¦­ ì´ë²¤íŠ¸
        div.querySelector('.post-header').addEventListener('click', () => {
          incrementViews(id);
          showPostDetail(id, data);
        });
        
        return div;
      }

      function incrementViews(postId) {
        const postRef = db.collection("posts").doc(postId);
        postRef.update({
          views: firebase.firestore.FieldValue.increment(1)
        });
      }

      function toggleLike() {
        const user = auth.currentUser;
        if (!user) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
        
        const postRef = db.collection("posts").doc(currentPostId);
        
        db.runTransaction(transaction => {
          return transaction.get(postRef).then(doc => {
            if (!doc.exists) return;
            
            const data = doc.data();
            const likes = data.likes || {};
            const likeCount = data.likeCount || 0;
            
            if (likes[user.uid]) {
              delete likes[user.uid];
              transaction.update(postRef, {
                likes,
                likeCount: likeCount - 1
              });
            } else {
              likes[user.uid] = true;
              transaction.update(postRef, {
                likes,
                likeCount: likeCount + 1
              });

              // ê²Œì‹œê¸€ ì‘ì„±ìì—ê²Œ ì¢‹ì•„ìš” ì•Œë¦¼
              if (data.authorId !== user.uid) {
                db.collection("users").doc(user.uid).get().then(userDoc => {
                  const userName = userDoc.data().name;
                  showBrowserNotification(
                    "ìƒˆë¡œìš´ ì¢‹ì•„ìš”",
                    `${userName}ë‹˜ì´ íšŒì›ë‹˜ì˜ ê²Œì‹œê¸€ì„ ì¢‹ì•„í•©ë‹ˆë‹¤.`
                  );
                  showNotification(
                    "ìƒˆë¡œìš´ ì¢‹ì•„ìš”",
                    `${userName}ë‹˜ì´ íšŒì›ë‹˜ì˜ ê²Œì‹œê¸€ì„ ì¢‹ì•„í•©ë‹ˆë‹¤.`,
                    "â¤ï¸"
                  );
                });
              }
            }
          });
        }).then(() => {
          loadPosts();
          postRef.get().then(doc => {
            if (doc.exists) {
              showPostDetail(currentPostId, doc.data());
            }
          });
        });
      }
      
      function editPost() {
        const user = auth.currentUser;
        if (!user || currentPost.authorId !== user.uid) return;
        
        const newTitle = prompt("ìˆ˜ì •í•  ì œëª©:", currentPost.title);
        const newContent = prompt("ìˆ˜ì •í•  ë‚´ìš©:", currentPost.content);
        
        if (newTitle && newContent) {
          db.collection("posts").doc(currentPostId).update({
            title: newTitle,
            content: newContent,
            updatedAt: new Date()
          }).then(() => {
            alert("ê²Œì‹œê¸€ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
            loadPosts();
            db.collection("posts").doc(currentPostId).get().then(doc => {
              if (doc.exists) {
                showPostDetail(currentPostId, doc.data());
              }
            });
          });
        }
      }
      
      function deletePost() {
        const user = auth.currentUser;
        if (!user || currentPost.authorId !== user.uid) return;
        
        if (confirm("ì •ë§ë¡œ ì´ ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
          db.collection("posts").doc(currentPostId).delete().then(() => {
            alert("ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
            document.getElementById("postDetail").style.display = "none";
            loadPosts();
          });
        }
      }

      function getSpeciesEmoji(species) {
        const emojiMap = {
          'polar-bear': 'ğŸ»â€â„ï¸',
          'cat': 'ğŸ±',
          'dinosaur': 'ğŸ¦–',
          'pig': 'ğŸ·',
          'fox': 'ğŸ¦Š',
          'dog': 'ğŸ¶',
          'bird': 'ğŸ¦',
          'fish': 'ğŸŸ',
          'snake': 'ğŸ',
          'tiger': 'ğŸ¯',
          'elephant': 'ğŸ˜',
          'monkey': 'ğŸ’',
          'none': ''
        };
        return emojiMap[species] || '';
      }

      function saveSpecies() {
        const species = document.getElementById("speciesModalSelect").value;
        if (!species) {
          alert("ì¢…ì¡±ì„ ì„ íƒí•´ì£¼ì„¸ìš”!");
          return;
        }

        const user = auth.currentUser;
        if (!user) return;

        db.collection("users").doc(user.uid).get().then(doc => {
          const userData = doc.exists ? doc.data() : {};
          return db.collection("users").doc(user.uid).set({
            ...userData,
            species: species
          });
        }).then(() => {
          document.getElementById("speciesModal").style.display = "none";
          // ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸
          db.collection("users").doc(user.uid).get().then(doc => {
            const name = doc.data().name || user.email;
            const speciesEmoji = getSpeciesEmoji(species);
            document.getElementById("userInfo").innerText = `${speciesEmoji} ${name}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`;
          });
        }).catch(error => {
          alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + error.message);
        });
      }

      // ì•Œë¦¼ ê¶Œí•œ ìš”ì²­ í•¨ìˆ˜
      async function requestNotificationPermission() {
        if (!("Notification" in window)) {
          console.log("ì´ ë¸Œë¼ìš°ì €ëŠ” ì•Œë¦¼ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
          return;
        }

        try {
          const permission = await Notification.requestPermission();
          if (permission === "granted") {
            showNotification("ì•Œë¦¼ ì„¤ì • ì™„ë£Œ", "ì•ìœ¼ë¡œ ìƒˆë¡œìš´ ì†Œì‹ì„ ì•Œë ¤ë“œë¦¬ê² ìŠµë‹ˆë‹¤!");
          }
        } catch (error) {
          console.error("ì•Œë¦¼ ê¶Œí•œ ìš”ì²­ ì¤‘ ì˜¤ë¥˜:", error);
        }
      }

      // ë¸Œë¼ìš°ì € ì•Œë¦¼ í‘œì‹œ í•¨ìˆ˜
      function showBrowserNotification(title, body) {
        if (Notification.permission === "granted") {
          new Notification(title, {
            body: body,
            icon: "https://www.google.com/favicon.ico" // ì—¬ê¸°ì— ì‹¤ì œ ì‚¬ì´íŠ¸ ì•„ì´ì½˜ URLì„ ë„£ìœ¼ì„¸ìš”
          });
        }
      }

      // ì¸ì•± ì•Œë¦¼ í‘œì‹œ í•¨ìˆ˜
      function showNotification(title, message, icon = "ğŸ’¬") {
        const notification = document.createElement("div");
        notification.className = "notification";
        notification.innerHTML = `
          <div class="notification-icon">${icon}</div>
          <div class="notification-content">
            <div class="notification-title">${title}</div>
            <div class="notification-message">${message}</div>
          </div>
        `;
        document.body.appendChild(notification);

        // 3ì´ˆ í›„ ì•Œë¦¼ ì œê±°
        setTimeout(() => {
          notification.remove();
        }, 3000);
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì•Œë¦¼ ê¶Œí•œ ìš”ì²­
      window.addEventListener('load', () => {
        requestNotificationPermission();
      });

      // ì‚¬ìš©ì ëª©ë¡ í‘œì‹œ í•¨ìˆ˜
      async function showUserList() {
        const userList = document.getElementById("userList");
        userList.innerHTML = "<h3>ì‚¬ìš©ì ëª©ë¡</h3>";
        
        const snapshot = await db.collection("users").get();
        snapshot.forEach(doc => {
          const userData = doc.data();
          const userDiv = document.createElement("div");
          userDiv.className = "user-item";
          
          const speciesEmoji = getSpeciesEmoji(userData.species || 'none');
          userDiv.innerHTML = `
            <div class="user-info">
              <span>${speciesEmoji}</span>
              <span>${userData.name || doc.id}</span>
              <span>${userData.email}</span>
            </div>
            <div class="user-actions">
              <button onclick="toggleUserBan('${doc.id}')" class="admin-button">
                ${userData.isBanned ? 'ì°¨ë‹¨ í•´ì œ' : 'ì°¨ë‹¨'}
              </button>
              <button onclick="deleteUser('${doc.id}')" class="admin-button">ê³„ì • ì‚­ì œ</button>
            </div>
          `;
          userList.appendChild(userDiv);
        });
      }

      // ì „ì²´ ê²Œì‹œê¸€ ê´€ë¦¬ í•¨ìˆ˜
      async function showAllPosts() {
        const posts = await db.collection("posts").get();
        const postList = document.getElementById("postList");
        postList.innerHTML = "<h2>ğŸ“„ ì „ì²´ ê²Œì‹œê¸€ ê´€ë¦¬</h2>";
        
        posts.forEach(doc => {
          const data = doc.data();
          const div = createPostElement(doc.id, data, true);
          postList.appendChild(div);
        });
      }

      // ì‚¬ìš©ì ì°¨ë‹¨/í•´ì œ í•¨ìˆ˜
      async function toggleUserBan(uid) {
        const userRef = db.collection("users").doc(uid);
        const doc = await userRef.get();
        const userData = doc.data();
        
        await userRef.update({
          isBanned: !userData.isBanned
        });
        
        showNotification(
          "ì‚¬ìš©ì ìƒíƒœ ë³€ê²½",
          `${userData.name}ë‹˜ì„ ${userData.isBanned ? 'ì°¨ë‹¨ í•´ì œ' : 'ì°¨ë‹¨'}í–ˆìŠµë‹ˆë‹¤.`,
          "ğŸ”’"
        );
        
        showUserList();
      }

      // ì‚¬ìš©ì ì‚­ì œ í•¨ìˆ˜
      async function deleteUser(uid) {
        if (!confirm("ì •ë§ë¡œ ì´ ì‚¬ìš©ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
        
        try {
          // ì‚¬ìš©ìì˜ ê²Œì‹œê¸€ ì‚­ì œ
          const posts = await db.collection("posts")
            .where("authorId", "==", uid)
            .get();
          
          posts.forEach(async (doc) => {
            await db.collection("posts").doc(doc.id).delete();
          });
          
          // ì‚¬ìš©ì ì •ë³´ ì‚­ì œ
          await db.collection("users").doc(uid).delete();
          
          showNotification(
            "ì‚¬ìš©ì ì‚­ì œ",
            "ì‚¬ìš©ìì™€ ê´€ë ¨ëœ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.",
            "ğŸ—‘ï¸"
          );
          
          showUserList();
        } catch (error) {
          console.error("ì‚¬ìš©ì ì‚­ì œ ì¤‘ ì˜¤ë¥˜:", error);
          showNotification(
            "ì˜¤ë¥˜ ë°œìƒ",
            "ì‚¬ìš©ì ì‚­ì œ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
            "âš ï¸"
          );
        }
      }

      // ëŒ€ì‹œë³´ë“œ í†µê³„ ì—…ë°ì´íŠ¸
      async function updateDashboardStats() {
          const stats = {
              totalUsers: await getTotalUsers(),
              newPosts: await getTodaysPosts(),
              activeUsers: await getActiveUsers(),
              bannedUsers: await getBannedUsers()
          };
          
          updateDashboardUI(stats);
      }

      // ê³ ê¸‰ ì‚¬ìš©ì ê´€ë¦¬
      async function manageUserRole(uid, role) {
          await db.collection('users').doc(uid).update({
              role: role,
              updatedAt: new Date(),
              updatedBy: auth.currentUser.uid
          });
          
          showNotification('ì—­í•  ë³€ê²½', `ì‚¬ìš©ì ì—­í• ì´ ${role}ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
      }

      // ì„ì‹œ ì°¨ë‹¨ ê¸°ëŠ¥
      async function temporaryBanUser(uid, days) {
          const banEndDate = new Date();
          banEndDate.setDate(banEndDate.getDate() + days);
          
          await db.collection('users').doc(uid).update({
              isBanned: true,
              banEndDate: banEndDate,
              banReason: document.getElementById('banReason').value
          });
      }

      // í™œë™ ë¡œê·¸ ê¸°ë¡
      function logAdminAction(action, details) {
          return db.collection('adminLogs').add({
              action,
              details,
              adminId: auth.currentUser.uid,
              timestamp: new Date()
          });
      }

      let currentReportPostId = null;

      function showReportModal(postId) {
        event.stopPropagation(); // ì´ë²¤íŠ¸ ë²„ë¸”ë§ ë°©ì§€
        const user = auth.currentUser;
        if (!user) {
          alert("ì‹ ê³ í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
          return;
        }

        currentReportPostId = postId;
        document.getElementById('reportModal').style.display = 'flex';
        document.getElementById('reportDetail').value = '';
        document.getElementById('reportReason').value = 'spam';
      }

      function closeReportModal() {
        document.getElementById('reportModal').style.display = 'none';
        currentReportPostId = null;
      }

      async function submitReport() {
        if (!currentReportPostId) return;

        const user = auth.currentUser;
        if (!user) return;

        const reason = document.getElementById('reportReason').value;
        const detail = document.getElementById('reportDetail').value.trim();

        if (!detail) {
          alert("ìƒì„¸ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }

        const report = {
          userId: user.uid,
          userName: user.displayName || user.email,
          reason: reason,
          detail: detail,
          timestamp: new Date()
        };

        try {
          await db.collection("posts").doc(currentReportPostId).update({
            reports: firebase.firestore.FieldValue.arrayUnion(report),
            isReported: true
          });

          // ê´€ë¦¬ìì—ê²Œ ì•Œë¦¼
          const admins = ADMIN_UIDS;
          admins.forEach(async (adminUid) => {
            await db.collection("notifications").add({
              userId: adminUid,
              type: 'report',
              postId: currentReportPostId,
              message: `ìƒˆë¡œìš´ ê²Œì‹œê¸€ ì‹ ê³ ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.`,
              createdAt: new Date(),
              read: false
            });
          });

          alert("ì‹ ê³ ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.");
          closeReportModal();
        } catch (error) {
          console.error("ì‹ ê³  ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:", error);
          alert("ì‹ ê³  ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ê²Œì‹œê¸€ ì‘ì„± í¼ì—ì„œ ê³µì§€ì‚¬í•­ ì˜µì…˜ ê´€ë¦¬
      function updatePostTypeOptions() {
        const postTypeSelect = document.getElementById('postType');
        const user = auth.currentUser;
        
        if (postTypeSelect) {
          postTypeSelect.innerHTML = `
            <option value="general">ì¼ë°˜ ê²Œì‹œê¸€</option>
            <option value="info">ì •ë³´ ê²Œì‹œê¸€</option>
            ${isAdmin(user?.uid) ? '<option value="notice">ê³µì§€ì‚¬í•­</option>' : ''}
          `;
        }
      }

      // ë””ìŠ¤ì½”ë“œ ì°¸ì—¬ ìš”ì²­ í•¨ìˆ˜
      async function requestDiscordJoin() {
        const user = auth.currentUser;
        if (!user) {
          alert("ë””ìŠ¤ì½”ë“œ ì°¸ì—¬ ìš”ì²­ì„ í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
          return;
        }
        document.getElementById('discordRequestModal').style.display = 'flex';
      }

      // ë””ìŠ¤ì½”ë“œ ì°¸ì—¬ ìš”ì²­ ëª¨ë‹¬ ë‹«ê¸°
      function closeDiscordRequestModal() {
        document.getElementById('discordRequestModal').style.display = 'none';
      }

      // ë””ìŠ¤ì½”ë“œ ì°¸ì—¬ ìš”ì²­ ì œì¶œ
      async function submitDiscordRequest() {
        const user = auth.currentUser;
        if (!user) return;

        const reason = document.getElementById("requestReason").value.trim();
        const robloxNickname = document.getElementById("robloxNickname").value.trim();
        const isInClan = document.getElementById("isInClan").value;

        if (!reason || !robloxNickname) {
          alert("ì°¸ì—¬ ì´ìœ ì™€ ë¡œë¸”ë¡ìŠ¤ ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }

        try {
          const userDoc = await db.collection("users").doc(user.uid).get();
          const userName = userDoc.data().name;
          const species = userDoc.data().species;
          const speciesEmoji = getSpeciesEmoji(species);

          // ì´ë¯¸ ìš”ì²­í•œ ì ì´ ìˆëŠ”ì§€ í™•ì¸
          const existingRequest = await db.collection("discord_requests")
            .where("userId", "==", user.uid)
            .where("status", "in", ["pending", "approved"])
            .get();

          if (!existingRequest.empty) {
            alert("ì´ë¯¸ ë””ìŠ¤ì½”ë“œ ì°¸ì—¬ ìš”ì²­ì„ í•˜ì…¨ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì˜ ìŠ¹ì¸ì„ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.");
            closeDiscordRequestModal();
            return;
          }

          // ìƒˆë¡œìš´ ìš”ì²­ ìƒì„±
          const requestData = {
            userId: user.uid,
            userName: userName,
            species: species,
            speciesEmoji: speciesEmoji,
            status: "pending",
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            message: `${speciesEmoji} ${userName}ë‹˜ì´ ë””ìŠ¤ì½”ë“œ ì°¸ì—¬ë¥¼ ìš”ì²­í–ˆìŠµë‹ˆë‹¤.`, // ê¸°ë³¸ ë©”ì‹œì§€
            reason: reason, // ì¶”ê°€ëœ ì´ìœ  í•„ë“œ
            robloxNickname: robloxNickname, // ì¶”ê°€ëœ ë¡œë¸”ë¡ìŠ¤ ë‹‰ë„¤ì„ í•„ë“œ
            isInClan: isInClan // ì¶”ê°€ëœ ì´ë¯¸ í´ëœ ìˆëŠ”ì§€ ì—¬ë¶€ í•„ë“œ
          };

          await db.collection("discord_requests").add(requestData);

          // ê´€ë¦¬ìë“¤ì—ê²Œ ì•Œë¦¼ ì „ì†¡
          for (const adminUid of ADMIN_UIDS) {
            await db.collection("notifications").add({
              userId: adminUid,
              type: 'discord_join_request',
              userName: userName,
              userSpecies: species,
              userSpeciesEmoji: speciesEmoji,
              message: `${speciesEmoji} ${userName}ë‹˜ì´ ë””ìŠ¤ì½”ë“œ ì°¸ì—¬ë¥¼ ìš”ì²­í–ˆìŠµë‹ˆë‹¤. (ì‚¬ìœ : ${reason}) (ë¡œë¸”ë¡ìŠ¤ ë‹‰ë„¤ì„: ${robloxNickname}) (ë‹¤ë¥¸ í´ëœ ì†Œì†: ${isInClan === 'yes' ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤'})`,
              createdAt: firebase.firestore.FieldValue.serverTimestamp(),
              read: false
            });
          }

          showNotification(
            "ì°¸ì—¬ ìš”ì²­ ì™„ë£Œ",
            "ê´€ë¦¬ì ê²€í†  í›„ ìŠ¹ì¸ë˜ë©´ ì•Œë ¤ë“œë¦¬ê² ìŠµë‹ˆë‹¤.",
            "ğŸ“¨"
          );

          closeDiscordRequestModal();
        } catch (error) {
          console.error("ë””ìŠ¤ì½”ë“œ ì°¸ì—¬ ìš”ì²­ ì¤‘ ì˜¤ë¥˜:", error);
          alert("ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ë””ìŠ¤ì½”ë“œ ì°¸ì—¬ ìš”ì²­ ëª©ë¡ í‘œì‹œ
      async function showDiscordRequests() {
        const requestsDiv = document.getElementById("discordRequests");
        const userListDiv = document.getElementById("userList");

        userListDiv.style.display = "none";
        requestsDiv.style.display = "block";
        requestsDiv.innerHTML = "<h3>ë””ìŠ¤ì½”ë“œ ì°¸ì—¬ ìš”ì²­ ëª©ë¡</h3>";

        try {
          const snapshot = await db.collection("discord_requests")
            .where("status", "==", "pending")
            .orderBy("createdAt", "desc")
            .get();

          if (snapshot.empty) {
            requestsDiv.innerHTML += "<p>ëŒ€ê¸° ì¤‘ì¸ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
            return;
          }

          snapshot.forEach(doc => {
            const request = doc.data();
            const requestDiv = document.createElement("div");
            requestDiv.className = "user-item";

            const createdAt = request.createdAt ? request.createdAt.toDate().toLocaleString() : 'ë‚ ì§œ ì—†ìŒ';
            const isInClanText = request.isInClan === 'yes' ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤';

            requestDiv.innerHTML = `
              <div class="user-info">
                <span>${request.speciesEmoji}</span>
                <span>${request.userName}</span>
                <span>ë¡œë¸”ë¡ìŠ¤ ë‹‰ë„¤ì„: ${request.robloxNickname}</span>
                <span>ì´ë¯¸ í´ëœ ì†Œì†: ${isInClanText}</span>
                <span>ìš”ì²­ ì´ìœ : ${request.reason}</span>
                <span>${createdAt}</span>
              </div>
              <div class="user-actions">
                <button onclick="approveDiscordRequest('${doc.id}', '${request.userName}')" class="admin-button">ìŠ¹ì¸</button>
                <button onclick="rejectDiscordRequest('${doc.id}', '${request.userName}')" class="admin-button">ê±°ì ˆ</button>
              </div>
            `;
            requestsDiv.appendChild(requestDiv);
          });
        } catch (error) {
          console.error("ìš”ì²­ ëª©ë¡ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜:", error);
          requestsDiv.innerHTML += "<p>ìš”ì²­ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>";
        }
      }

      // ë””ìŠ¤ì½”ë“œ ì°¸ì—¬ ìš”ì²­ ìŠ¹ì¸
      async function approveDiscordRequest(requestId, userName) {
        try {
          const requestDoc = await db.collection("discord_requests").doc(requestId).get();
          const request = requestDoc.data();

          // ìš”ì²­ ìƒíƒœ ì—…ë°ì´íŠ¸
          await db.collection("discord_requests").doc(requestId).update({
            status: 'approved',
            approvedAt: firebase.firestore.FieldValue.serverTimestamp()
          });

          // ì‚¬ìš©ìì—ê²Œ ìŠ¹ì¸ ì•Œë¦¼ ë° ë””ìŠ¤ì½”ë“œ ë§í¬ ì „ì†¡
          await db.collection("notifications").add({
            userId: request.userId,
            type: 'discord_join_approved',
            message: 'ë””ìŠ¤ì½”ë“œ ì°¸ì—¬ê°€ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ì•„ë˜ ë§í¬ë¡œ ì°¸ì—¬í•´ì£¼ì„¸ìš”.',
            discordLink: 'https://discord.gg/uZmsRDyYkQ',
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            read: false
          });

          // ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸
          await db.collection("users").doc(request.userId).update({
            discordApproved: true,
            discordApprovedAt: firebase.firestore.FieldValue.serverTimestamp()
          });

          showNotification(
            "ìš”ì²­ ìŠ¹ì¸ ì™„ë£Œ",
            `${userName}ë‹˜ì˜ ë””ìŠ¤ì½”ë“œ ì°¸ì—¬ ìš”ì²­ì„ ìŠ¹ì¸í–ˆìŠµë‹ˆë‹¤.`,
            "âœ…"
          );

          showDiscordRequests();
        } catch (error) {
          console.error("ìš”ì²­ ìŠ¹ì¸ ì¤‘ ì˜¤ë¥˜:", error);
          alert("ìš”ì²­ ìŠ¹ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ë””ìŠ¤ì½”ë“œ ì°¸ì—¬ ìš”ì²­ ê±°ì ˆ
      async function rejectDiscordRequest(requestId, userName) {
        try {
          const requestDoc = await db.collection("discord_requests").doc(requestId).get();
          const request = requestDoc.data();

          // ìš”ì²­ ìƒíƒœ ì—…ë°ì´íŠ¸
          await db.collection("discord_requests").doc(requestId).update({
            status: 'rejected',
            rejectedAt: firebase.firestore.FieldValue.serverTimestamp()
          });

          // ì‚¬ìš©ìì—ê²Œ ê±°ì ˆ ì•Œë¦¼
          await db.collection("notifications").add({
            userId: request.userId,
            type: 'discord_join_rejected',
            message: 'ë””ìŠ¤ì½”ë“œ ì°¸ì—¬ ìš”ì²­ì´ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤.',
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            read: false
          });

          showNotification(
            "ìš”ì²­ ê±°ì ˆ ì™„ë£Œ",
            `${userName}ë‹˜ì˜ ë””ìŠ¤ì½”ë“œ ì°¸ì—¬ ìš”ì²­ì„ ê±°ì ˆí–ˆìŠµë‹ˆë‹¤.`,
            "âŒ"
          );

          showDiscordRequests();
        } catch (error) {
          console.error("ìš”ì²­ ê±°ì ˆ ì¤‘ ì˜¤ë¥˜:", error);
          alert("ìš”ì²­ ê±°ì ˆ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ë””ìŠ¤ì½”ë“œ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
      async function updateDiscordButton() {
        const user = auth.currentUser;
        if (!user) return;

        const discordButton = document.querySelector('.discord-button');
        if (!discordButton) return;

        try {
          // ì‚¬ìš©ìì˜ ë””ìŠ¤ì½”ë“œ ìŠ¹ì¸ ìƒíƒœ í™•ì¸
          const userDoc = await db.collection("users").doc(user.uid).get();
          const userData = userDoc.data();

          if (userData?.discordApproved) {
            // ìŠ¹ì¸ëœ ê²½ìš° ë””ìŠ¤ì½”ë“œ ë§í¬ë¡œ ì´ë™í•˜ëŠ” ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½
            discordButton.innerHTML = `
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.118.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.419c0 1.334-.956 2.419-2.157 2.419zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.419c0 1.334-.946 2.419-2.157 2.419z"/>
              </svg>
              ë””ìŠ¤ì½”ë“œ ì°¸ì—¬í•˜ê¸°
            `;
            discordButton.onclick = () => window.open('https://discord.gg/uZmsRDyYkQ', '_blank');
          } else {
            // ìŠ¹ì¸ë˜ì§€ ì•Šì€ ê²½ìš° ìš”ì²­ ë²„íŠ¼ìœ¼ë¡œ ìœ ì§€
            discordButton.innerHTML = `
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.118.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.419c0 1.334-.956 2.419-2.157 2.419zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.419c0 1.334-.946 2.419-2.157 2.419z"/>
              </svg>
              ë””ìŠ¤ì½”ë“œ ì°¸ì—¬ ìš”ì²­
            `;
            discordButton.onclick = requestDiscordJoin;
          }
        } catch (error) {
          console.error("ë””ìŠ¤ì½”ë“œ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜:", error);
        }
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ë””ìŠ¤ì½”ë“œ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
      auth.onAuthStateChanged(user => {
        if (user) {
          updateDiscordButton();
        }
      });

      function googleLogin() {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider)
          .then((result) => {
            // êµ¬ê¸€ ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì‚¬ìš©ì ì •ë³´ ì €ì¥
            const user = result.user;
            return db.collection("users").doc(user.uid).set({
              name: user.displayName || user.email,
              email: user.email,
              photoURL: user.photoURL
            }, { merge: true });
          })
          .then(() => {
            alert("êµ¬ê¸€ ë¡œê·¸ì¸ ì™„ë£Œ");
          })
          .catch((error) => {
            alert("êµ¬ê¸€ ë¡œê·¸ì¸ ì‹¤íŒ¨: " + error.message);
          });
      }
    </script>
  </main>

  <!-- ì¢…ì¡± ì„ íƒ ëª¨ë‹¬ -->
  <div id="speciesModal" class="modal-overlay" style="display: none;">
    <div class="modal">
      <h2>ì¢…ì¡± ì„ íƒ</h2>
      <p>ì»¤ë®¤ë‹ˆí‹° í™œë™ì„ ìœ„í•´ ì¢…ì¡±ì„ ì„ íƒí•´ì£¼ì„¸ìš”!</p>
      <select id="speciesModalSelect" class="species-select">
        <option value="">ì¢…ì¡±ì„ ì„ íƒí•˜ì„¸ìš”</option>
        <option value="polar-bear">ğŸ»â€â„ï¸ ë¶ê·¹ê³°</option>
        <option value="cat">ğŸ± ê³ ì–‘ì´</option>
        <option value="dinosaur">ğŸ¦– ê³µë£¡</option>
        <option value="pig">ğŸ· ë¼ì§€</option>
        <option value="fox">ğŸ¦Š ì—¬ìš°</option>
        <option value="dog">ğŸ¶ ê°•ì•„ì§€</option>
        <option value="bird">ğŸ¦ ìƒˆ</option>
        <option value="fish">ğŸŸ ë¬¼ê³ ê¸°</option>
        <option value="snake">ğŸ ë„ë§ˆë±€</option>
        <option value="tiger">ğŸ¯ í˜¸ë‘ì´</option>
        <option value="elephant">ğŸ˜ ì½”ë¼ë¦¬</option>
        <option value="monkey">ğŸ’ ì›ìˆ­ì´</option>
        <option value="none">âŒ ì—†ìŒ</option>
      </select>
      <div class="modal-buttons">
        <button onclick="saveSpecies()">ì €ì¥</button>
      </div>
    </div>
  </div>

  <div id="adminPanel" style="display: none;" class="admin-panel">
    <h2>ê´€ë¦¬ì íŒ¨ë„</h2>
    <div class="admin-controls">
      <button onclick="showUserList()" class="admin-button">ì‚¬ìš©ì ê´€ë¦¬</button>
      <button onclick="showAllPosts()" class="admin-button">ì „ì²´ ê²Œì‹œê¸€ ê´€ë¦¬</button>
      <button onclick="showDiscordRequests()" class="admin-button">ë””ìŠ¤ì½”ë“œ ì°¸ì—¬ ìš”ì²­</button>
    </div>
    <div id="userList" class="user-list"></div>
    <div id="discordRequests" class="user-list" style="display: none;"></div>
  </div>

  <!-- ë””ìŠ¤ì½”ë“œ ì°¸ì—¬ ìš”ì²­ ëª¨ë‹¬ -->
  <div id="discordRequestModal" class="modal-overlay" style="display: none;">
    <div class="modal">
      <h2>ë””ìŠ¤ì½”ë“œ ì°¸ì—¬ ìš”ì²­</h2>
      <p>ì•„ë˜ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
      <textarea id="requestReason" placeholder="ì°¸ì—¬í•˜ê³  ì‹¶ì€ ì´ìœ ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”." rows="4"></textarea>
      <input type="text" id="robloxNickname" placeholder="ë¡œë¸”ë¡ìŠ¤ ë‹‰ë„¤ì„">
      <label for="isInClan">ì´ë¯¸ ë‹¤ë¥¸ í´ëœì— ì†Œì†ë˜ì–´ ìˆë‚˜ìš”?</label>
      <select id="isInClan">
        <option value="no">ì•„ë‹ˆì˜¤</option>
        <option value="yes">ì˜ˆ</option>
      </select>
      <div class="modal-buttons">
        <button onclick="submitDiscordRequest()">ìš”ì²­ ì œì¶œ</button>
        <button onclick="closeDiscordRequestModal()" class="modern-button">ì·¨ì†Œ</button>
      </div>
    </div>
  </div>

</body>
</html>
